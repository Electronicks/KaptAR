window.blueprint=window.blueprint||{};blueprint.Converter=function(b){var v=10000;var j=60000;var p=0;var h="https://s3-eu-west-1.amazonaws.com/studio-live/0000staticfiles/mini-loader.png";var s=AR.build.mobile?true:false;var d=null;var u=true;this.convertProject=function(C){console.log("Converting "+C.targets.length+" targets.");d=new AR.Tracker(C.targetCollectionUrl,{onLoaded:function(){console.log("Target Collection fully loaded.")},onError:function(){alert("Target Collection cannot be loaded.")}});u=C.targets.length>p;for(var x=0;x<C.targets.length;x++){var A=C.targets[x];var w=[];for(var y=0;y<A.augmentations.length;y++){var B=c(C,A,A.augmentations[y]);if(B){if(Array.isArray(B)){w=w.concat(B)}else{w.push(B)}}}var z=k(C,A,w);if(!u){z.drawables.cam=w}}};var k=function(B,A,w){w=w||[];var z=function(D){for(var C=0;C<D.drawables.cam.length;C++){if(D.drawables.cam[C].onExitFieldOfVision){D.drawables.cam[C].onExitFieldOfVision()}}};var y=new AR.Trackable2DObject(d,A.label.toString(),{onEnterFieldOfVision:function(){if(s){if(!this.detectionTime||new Date().getTime()-this.detectionTime.getTime()>v){this.detectionTime=new Date()}}if(u){if(y.destroyTimer){window.clearTimeout(y.destroyTimer);y.destroyTimer=null;return}var C=[];for(var D=0;D<w.length;D++){var E=w[D]();if(Array.isArray(E)){C=C.concat(E)}else{C.push(E)}}y.drawables.cam=C}for(var D=0;D<y.drawables.cam.length;D++){if(y.drawables.cam[D].onEnterFieldOfVision){y.drawables.cam[D].onEnterFieldOfVision()}}},onExitFieldOfVision:u?function x(){y.destroyDrawables=function(){var D=y.drawables.cam;y.drawables.cam=[];for(var C=0;C<D.length;C++){if(D[C].removeFromTarget){D[C].removeFromTarget()}}y.destroyTimer=null};y.destroyTimer=window.setTimeout(y.destroyDrawables,j);z(y)}:function(){z(y)}});return y};var c=function(z,y,w){var x=null;switch(w.type){case"Image":x=e(z,y,w);break;case"Button":x=n(z,y,w);break;case"Text":x=q(z,y,w);break;case"HTMLDrawable":x=r(z,y,w);break;case"Model":x=t(z,y,w);break;case"Video":if(!AR.VideoDrawable){alert("Your current Wikitude SDK version does not support Video Drawables. Please upgrade to a newer SDK. Video Drawables will not be shown.");return null}x=l(z,y,w);break}if(!u){return x()}else{return x}};var e=function(y,x,w){return function(){var C=new AR.ImageResource(w.url);var B=f(y,x,w);if(w.clickUrl!==""){var z=function(){AR.context.openInBrowser(w.clickUrl)};B.onClick=B.onClick?(function(E,D){return function(){E();D()}})(B.onClick,z):z}var A=new AR.ImageDrawable(C,w.height/100,B);A.removeFromTarget=function(){C.destroy();A.destroy()};return A}};var q=function(y,w,x){return function(){var B=f(y,w,x);B.style={backgroundColor:i(x.backgroundColor),textColor:i(x.textColor),fontStyle:x.textStyle===""?"normal":x.textStyle};if(x.clickUrl!==""){var z=function(){AR.context.openInBrowser(x.clickUrl)};B.onClick=B.onClick?(function(D,C){return function(){D();C()}})(B.onClick,z):z}var A=new AR.Label(x.text,x.height/100,B);A.removeFromTarget=function(){A.destroy()};return A}};var r=function(y,w,x){return function(){var B=f(y,w,x);var F=1;var z=Math.ceil(F*w.size.width*x.width/100);var A=Math.ceil(F*w.size.height*x.height/100);z=Math.ceil(z/x.zoom);A=Math.ceil(A/x.zoom);if(z>1023){var E=z/1023;z=1023;A=Math.ceil(A*E);x.zoom=x.zoom/E}A=A>1023?1023:A;B.viewportWidth=z+1;B.viewportHeight=A;var D=x.src;if(D.indexOf("<body")==-1){D='<html><head><meta name="viewport" content="initial-scale=1.0,user-scalable=no,target-densitydpi=device-dpi,width='+z+"\"/><link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'></head><body style=\"display:inline-block;font: 10px 'Open Sans',sans-serif;letter-spacing:1px;font-weight:300;background:transparent;margin:0;";D+='">'+x.src+"</body></html>"}var C=new AR.HtmlDrawable({html:D},x.width/100*(w.size.width/w.size.height),B);C.removeFromTarget=function(){C.destroy()};return C}};var t=function(y,x,w){return function(){var z=x.size.width*w.width/100;var B=x.size.height*w.height/100;var A=new AR.Model(w.src,{scale:{x:w.scale,y:w.scale,z:w.scale},rotate:{roll:w.rotation*-1},translate:{x:w.x/100-0.5+(z*0.5/x.size.height),y:-1*(w.y/100-0.5+(B*0.5/x.size.height)),}});A.removeFromTarget=function(){A.destroy()};return A}};var n=function(y,x,w){return function(){var C=f(y,x,w);var G=1.1;var A=Math.ceil(G*x.size.width*w.width/100);var B=Math.ceil(G*x.size.height*w.height/100);if(A>1024){var F=A/1024;A=1024;B=Math.ceil(B*F)}B=B>1024?1024:B;C.viewportWidth=A;C.viewportHeight=B;var z=function(){AR.context.openInBrowser(w.url)};C.onClick=C.onClick?(function(I,H){return function(){I();H()}})(C.onClick,z):z;var E='<html><head><meta name="viewport" content="target-densitydpi=device-dpi,width='+A+"\"/><link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'></head><body style=\"display:inline-block;font: 30px 'Open Sans',sans-serif;letter-spacing:1px;font-weight:300;background:transparent;margin:0;letter-spacing:1px;\">";E+='<div style="display:inline-block;background-color:'+g(w.backgroundColor);E+="; background-repeat:no-repeat";E+="; background-size:100%";if(w.backgroundImage){E+="; background-image:url("+w.backgroundImage+")"}E+="; border-radius:6px;";E+=" text-align:center;";E+=" padding:5px 10px;";E+=" text-decoration:none;";E+=" border:1px solid "+g(w.borderColor);E+="; color:"+g(w.textColor);if(!w.zoom){E+="; font-size:"+w.textSize+"em"}else{E+="; -webkit-transform:scale("+w.zoom+")";E+="; transform:scale("+w.zoom+")";E+="; -webkit-transform-origin:left top";E+="; transform-origin:left top;"}E+=';">'+w.text;E+="</div></body></html>";var D=new AR.HtmlDrawable({html:E},w.width/100*(x.size.width/x.size.height),C);D.removeFromTarget=function(){D.destroy()};return D}};var l=function(y,x,w){if(w.subType=="PrivateVideo"){if(w.videoMode=="fullscreen"){return m(y,x,w)}else{return a(y,x,w)}}else{if(w.subType=="SocialVideo"){return m(y,x,w)}}};var a=function(y,x,w){return function(){var I=f(y,x,w);I.isTransparent=w.videoMode=="overlayAlpha";var E=new AR.VideoDrawable(w.src,w.height/100/(I.isTransparent?2:1),I);E.enabled=false;var D=function(){if(E.state=="PLAYING"){E.state="PAUSED";E.pause()}else{if(E.state=="PAUSED"){E.state="PLAYING";E.resume()}}};E.onClick=I.onClick?(function(K,J){return function(){K();J()}})(I.onClick,D):D;E.onEnterFieldOfVision=function(){if(E.state=="PAUSED"){E.state="PLAYING";E.resume()}};E.onExitFieldOfVision=function(){if(E.state=="PLAYING"){E.state="PAUSED";E.pause()}};E.state="LOADING";var F=[];F.push(function(){E.state="LOADED"});var A=function(){E.state="PLAYING";E.enabled=true;E.play(w.endlessLoop?-1:1)};var C=new AR.ImageResource(w.thumbnailUrl);var H=new AR.ImageDrawable(C,w.height/100,I);H.removeFromTarget=function(){H.imageResource.destroy();H.destroy()};var B=function(){F.push(function(){if(H){H.removeFromTarget()}A()})};var G=function(){var J=new AR.ImageResource(h);H.imageResource.destroy();H.imageResource=J;var K=new AR.PropertyAnimation(H,"rotation",0,360,1000);K.start(-1)};if(w.autoPlay){B()}else{var z=function(){if(E.state=="LOADED"){H.removeFromTarget();A()}else{if(E.state=="LOADING"){G();B()}}};H.onClick=I.onClick?(function(K,J){return function(){K();J()}})(I.onClick,z):z}E.onLoaded=function(){for(var J=0;J<F.length;J++){F[J]()}};E.removeFromTarget=function(){E.destroy();if(H&&!H.destroyed){H.removeFromTarget()}};return[E,H]}};var m=function(y,x,w){return function(){if(w.autoPlay){C=new AR.Circle(1,{enabled:false});C.onEnterFieldOfVision=function(){if(w.subType=="PrivateVideo"){AR.context.startVideoPlayer(w.src)}else{AR.context.openInBrowser(w.src)}}}else{var A=f(y,x,w);var B=new AR.ImageResource(w.thumbnailUrl);var C=new AR.ImageDrawable(B,w.height/100,A);var z=function(){if(w.subType=="PrivateVideo"){AR.context.startVideoPlayer(w.src)}else{AR.context.openInBrowser(w.src)}};C.onClick=A.onClick?(function(E,D){return function(){E();D()}})(A.onClick,z):z}C.removeFromTarget=function(){if(C.imageResource&&!C.imageResource.destroyed){C.imageResource.destroy()}C.destroy()};return C}};var f=function(z,y,w){var x={offsetX:(w.x/100-0.5+(w.width/200))*(y.size.width/y.size.height),offsetY:-1*(w.y/100-0.5+(w.height/200)),opacity:w.opacity/100,rotation:w.rotation,zOrder:w.zOrder};return x};var i=function(w){var x="#";x+=o(w.r);x+=o(w.g);x+=o(w.b);x+=o(Math.floor(w.a*255));return x};var g=function(w){var x="rgba(";x+=w.r+",";x+=w.g+",";x+=w.b+",";x+=w.a+")";return x};var o=function(x){var w=x.toString(16);return w.length==2?w:"0"+w}};